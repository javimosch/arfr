<!DOCTYPE html>
<html>

<head>
    {{>auto-reload}}
    <link rel="stylesheet" href="/css/main.css" type="text/css" />
    <title>Test</title>
    <style>
        div.panel-rt6 {
            background: skyblue;
            padding: 0px;
            margin: 0px;
        }
        
        table.panel-rt6 {
            min-width: 100%;
            outline: 1px dashed black;
        }
        
        td.panel-rt6 {
            min-width: 50%;
        }
        
        ul.panel-rt6 {
            list-style: none;
            padding: 0px;
            margin:20px;
        }
    </style>
</head>

<body>
    <div id="wrapper">

    </div>
    <script src="//cdnjs.cloudflare.com/ajax/libs/maquette/2.4.1/maquette.min.js"></script>
    <script type="text/javascript">
        var h = maquette.h;
        var projector = maquette.createProjector();

        function getColumnName(key) {
            return '#' + key.charAt(0).toUpperCase() + key.slice(1);
        }

        function renderTableColumns() {
            if (items.length == 0) return [];
            return Object.keys(items[0]).map(key => h('td.panel-rt6', [getColumnName(key)]));
        }

        function renderItemColumns(item) {
            return Object.keys(item).map(key => h('td.panel-rt6', [item[key]]));
        }

        var perPage = 10;
        var pagination = {
            totalCount: function() {
                return items.length
            },
            perPage: perPage,
            page: 1,
            pages: function() {
                return Math.ceil(this.totalCount() / this.perPage)
            },
            offset: 0,
            paginate: function(evt) {
                this.page = evt.target.value;
                this.offset = this.page * this.perPage; //0*10=0  1*10=10 2*10=20
                projector.scheduleRender();
            },
            render: function() {
                var li = [],
                    pages = this.pages();
                for (var x = 1; x < pages; x++)
                    li.push(h('li.link', {
                        bind: pagination,
                        key: x,
                        value: x,
                        onclick: this.paginate,
                        styles: {
                            display: 'inline',
                            padding: '5px 2px',
                            'background-color': x == this.page ? 'snow' : 'transparent'
                        }
                    }, [x]));
                return h('ul.panel-rt6', li);
            },
            renderRows: function() {
                var itemsForPage = items.slice(this.offset, this.offset + this.perPage);
                return itemsForPage.map(x => h('tr', [
                    Object.keys(x).map(key => h('td.panel-rt6', [x[key]]))
                ]));
            }
        };

        var items = [];
        for (var x = 0; x < 100; x++) {
            items.push({
                name: "Dario " + x,
                edad: Math.round(Math.random() * 100)
            });
        }

        function renderMaquette() {
            return h('div.panel-rt6', [
                h('div.panel-rt6', [
                    pagination.render()
                ]),
                h('table.panel-rt6', [
                    h('thead.panel-rt6', [
                        h('tr', renderTableColumns())
                    ]),
                    h('tbody.panel-rt6', pagination.renderRows())
                ])

            ]);
        }
        document.addEventListener('DOMContentLoaded', function() {
            projector.append(document.querySelector('#wrapper'), renderMaquette);
        });
    </script>

</body>

</html>
